<!DOCTYPE html><html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Novedades de rol para 3-6 Personajes de Nivel 10</title>
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap');
            @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap');
            body{
                font-family:'Lato',sans-serif;color:#333;margin:0;
                background: linear-gradient(to bottom, #2c3e50, #0a2e47);
                min-height: 100vh;
                background-attachment: fixed;
                margin: 0;
                margin-bottom: 3rem;
                padding: 0;
            }
            .container{max-width:1200px;margin:auto;padding: 2rem;}
            h1{
                margin-top: 3rem; line-height: 3.3rem; margin-bottom: .5rem;
                text-align:center;color:white;
                font-weight:800;font-size:4rem;font-family: "Roboto", sans-serif;
            }
            h4{
                margin-bottom: 0;
                text-align:center;color:white;
                font-size:1.2rem;font-weight:400;font-family: "Roboto", sans-serif;
            }
            .game-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:2rem}
            .game-card{background-color:#fff;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,.05);overflow:hidden;display:flex;flex-direction:column;transition:transform .3s ease,box-shadow .3s ease;position:relative}.game-card:hover{transform:translateY(-5px);box-shadow:0 8px 25px rgba(0,0,0,.1)}.game-card img{width:100%;aspect-ratio:16 / 10;object-fit:cover;border-bottom:1px solid #eee}.card-content{padding:1.5rem;display:flex;flex-direction:column;flex-grow:1}.title-wrapper{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:.75rem}.card-content h2{margin:0;font-size:1.25rem;color:#2c3e50;flex-grow:1}.card-content h2 a{text-decoration:none;color:inherit}.card-content h2 a:hover{color:#e59b25;text-decoration: underline;}.price-tag{font-size:.9rem;font-weight:700;padding:.25rem .5rem;border-radius:4px;background-color:#e9ecef;color:#495057;white-space:nowrap;margin-left:.5rem}.price-tag.free{background-color:#28a745;color:#fff}.card-content p{margin:0;font-size:.95rem;line-height:1.6;flex-grow:1;color:#555}.source-badge{position:absolute;top:1rem;right:1rem;padding:.3rem .6rem;border-radius:6px;font-size:.8rem;font-weight:700;color:#fff;z-index:10}
            .filter-controls {text-align: center;margin-bottom: 2rem;}
            .filter-btn {background-color: #fff;border: 1px solid #ddd;border-radius: 20px;padding: .5rem 1rem;margin: 0.25rem;font-family: 'Lato', sans-serif;font-size: .9rem;cursor: pointer;transition: all .2s ease;}
            .filter-btn:hover {background-color: #e9ecef;border-color: #ccc;}
            .filter-btn.active {background-color: #000000;color: #fff;border-color: #2c3e50;}
            .game-card.hidden {display: none;}
            .source-indies{background-color:#fa5c5c} /* Rojo para Indies */
            .source-drivethrurpg{background-color:#1e62a3} /* Se mantiene por si acaso, pero se usará Indies */
            .source-en-tiendas{background-color:#17a2b8} /* Cian para En Tiendas */
            .source-preventa{background-color:#ffc107;color:#212529} /* Amarillo para Preventa */
            .source-avance{background-color:#212529;color:#ffffff} /* Negro para Avances */
            .source-evento{background-color:#8e44ad;color:#ffffff} /* Negro para Avances */
            .card-footer {margin-top: 1rem;text-align: right;}
            .added-date {font-size: 0.8rem;color: #888;font-style: italic;}
            @media (max-width:900px){.game-grid{grid-template-columns:repeat(2,1fr)}}
            @media (max-width:600px){.game-grid{grid-template-columns:1fr}.container{padding:1rem}.top-bar{padding: 2rem;}}
            /* Estilos para la paginación */
            #pagination-controls {display: flex;justify-content: center;align-items: center;margin-top: 2.5rem;gap: 0.5rem;}
            .pagination-btn {border: 1px solid #ddd;background-color: #fff;padding: 0.5rem 1rem;cursor: pointer;border-radius: 6px;font-family: 'Roboto', sans-serif;transition: all 0.2s ease;}
            .pagination-btn:hover {background-color: #e9ecef;border-color: #ccc;}
            .pagination-btn.active {background-color: black;color: #fff;border-color: black;font-weight: 700;}
            .pagination-btn:disabled {cursor: not-allowed;opacity: 0.6;}
            /* --- Barra Superior --- */
            .top-bar {background-color: #e59b25;color: black;display: flex;justify-content: space-between;align-items: center;padding: 0.6rem 1.5rem;font-family: sans-serif;font-weight: bold;font-size: 1.1rem;margin-bottom: 2rem;position: relative;}
            .top-bar-right {font-size: 0.8rem;}
            .top-bar-center {position: absolute;left: 50%;transform: translateX(-50%);text-align: center;}
        </style>
        <meta property="og:title" content="Novedades de rol en Español">
        <meta property="og:description" content="Mantente al día con las últimas novedades de rol en español. Descubre los lanzamientos más recientes, preventas, títulos independientes y próximos juegos en un solo lugar.">
        <meta property="og:image" content="https://pbs.twimg.com/profile_banners/15847515/1678908416/1500x500">
        <meta property="og:url" content="https://malditomaster.github.io/rol/">
        <meta property="og:type" content="website">
        <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
        <link rel="icon" href="favicon.ico">
        <link rel="manifest" href="site.webmanifest">
    </head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NZCKL3M3XY"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-NZCKL3M3XY');
</script>
<body>
    <header class="top-bar">
        <span class="top-bar-left">M2</span>
        <span class="top-bar-center">Novedades de rol para 3-6 Personajes de Nivel 10</span>
        <span id="update-date" class="top-bar-right"></span>
    </header>
    <h1>Compendio de<br/>Novedades Roleras</h1>
    <h4>de malditomaster</h4>

    <div class="container">
        <div class="filter-controls">
            <button class="filter-btn active" onclick="filterSource('all')">Todos</button>
            <button class="filter-btn" onclick="filterSource('AVANCE')">Avance</button>
            <button class="filter-btn" onclick="filterSource('MECENAZGOS')">Mecenazgos</button>
            <button class="filter-btn" onclick="filterSource('EN TIENDAS')">En Tiendas</button>
            <button class="filter-btn" onclick="filterSource('PREVENTA')">Preventa</button>
            <button class="filter-btn" onclick="filterSource('INDIES')">Indies</button>
            <button class="filter-btn" onclick="filterSource('EVENTO')">Evento</button>
        </div>
        <div class="game-grid"></div>
        <div id="pagination-controls"></div>
    </div>
    <script>
        // 1. URL actualizada para usar TSV (Tab-Separated Values)
        const gamesTsvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTgzzR6lr2G9omEWVZMdVg_wo7qKCrU1yf-itizHQ2M5mGaKDJUg1fmG7QknJ9pAQZMf_pB9AyEYTBn/pub?gid=0&single=true&output=tsv';
        
        const dateTsvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTgzzR6lr2G9omEWVZMdVg_wo7qKCrU1yf-itizHQ2M5mGaKDJUg1fmG7QknJ9pAQZMf_pB9AyEYTBn/pub?gid=2131940647&single=true&output=tsv';

        // Variables para la paginación
        let allGames = []; // Almacenará la lista maestra de todos los juegos
        let filteredGames = []; // Almacenará los juegos después de aplicar un filtro
        let currentPage = 1;
        const itemsPerPage = 18;

        async function loadUpdateDate() {
            const dateElement = document.getElementById('update-date');
            try {
                const response = await fetch(dateTsvUrl);
                if (!response.ok) throw new Error('No se pudo cargar la fecha.');
                
                const dateText = await response.text();
                // Asumimos que la fecha está en la primera celda
                dateElement.innerText = `${dateText.trim()}`;

            } catch (error) {
                console.error("Error al obtener la fecha:", error);
                dateElement.innerText = 'Fecha no disponible';
            }
        }

        async function loadGames() {
            // Primero, cargamos la fecha de actualización
            await loadUpdateDate();

            try {
                const response = await fetch(gamesTsvUrl);
                if (!response.ok) throw new Error(`Error en la red: ${response.statusText}`);
                
                const tsvData = await response.text();
                const rows = tsvData.trim().split('\n').slice(1);

                allGames = rows.map(row => {
                    const columns = row.split('\t');
                    const [title, source, imageUrl, link, price, description, date] = columns;
                    return { title, source, imageUrl, link, price, description, date };
                });

                // Al inicio, la lista filtrada es igual a la lista completa
                filteredGames = [...allGames]; 
                
                displayPage(1);
                setupPagination();

            } catch (error) {
                console.error('Error al cargar los datos:', error);
                document.querySelector('.game-grid').innerHTML = '<p>No se pudieron cargar los juegos. Inténtalo de nuevo más tarde.</p>';
            }
        }

        function displayPage(page) {
            window.scrollTo({ top: 0, behavior: 'smooth' });

            const gameGrid = document.querySelector('.game-grid');
            gameGrid.innerHTML = '';
            currentPage = page;

            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            // --- MODIFICADO: Usa la lista 'filteredGames' ---
            const paginatedItems = filteredGames.slice(startIndex, endIndex);

            const cardsHtml = paginatedItems.map(game => {
                 if (!game.title) return '';
                const priceStr = game.price || '';
                const sourceStr = game.source || 'INDIES';
                const priceClass = priceStr.toLowerCase().includes('gratis') ? 'price-tag free' : 'price-tag';
                const sourceClass = sourceStr.trim().toLowerCase().replace(/\s+/g, '-');

                return `
                    <div class="game-card" data-source="${sourceStr.trim()}">
                        <span class="source-badge source-${sourceClass}">${sourceStr.trim()}</span>
                        <img src="${(game.imageUrl || '').trim()}" alt="Imagen de ${game.title.trim()}">
                        <div class="card-content">
                            <div class="title-wrapper">
                                <h2><a href="${(game.link || '#').trim()}" target="_blank" rel="noopener noreferrer">${game.title.trim()}</a></h2>
                                <span class='${priceClass}'>${priceStr.trim()}</span>
                            </div>
                            <p>${(game.description || '').trim()}</p>
                            <div class="card-footer">
                                <span class="added-date">${(game.date || '').trim()}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            gameGrid.innerHTML = cardsHtml;
            updatePaginationButtons();
        }
        
        function setupPagination() {
            const controlsContainer = document.getElementById('pagination-controls');
            controlsContainer.innerHTML = '';
            // --- MODIFICADO: Usa la lista 'filteredGames' ---
            const pageCount = Math.ceil(filteredGames.length / itemsPerPage);

            if (pageCount <= 1) return; // No mostrar controles si solo hay una página

            const prevButton = document.createElement('button');
            prevButton.classList.add('pagination-btn');
            prevButton.innerText = 'Anterior';
            prevButton.addEventListener('click', () => {
                if (currentPage > 1) displayPage(currentPage - 1);
            });
            controlsContainer.appendChild(prevButton);

            for (let i = 1; i <= pageCount; i++) {
                const button = document.createElement('button');
                button.classList.add('pagination-btn');
                button.dataset.page = i;
                button.innerText = i;
                button.addEventListener('click', () => displayPage(i));
                controlsContainer.appendChild(button);
            }
            
            const nextButton = document.createElement('button');
            nextButton.classList.add('pagination-btn');
            nextButton.innerText = 'Siguiente';
            nextButton.addEventListener('click', () => {
                if (currentPage < pageCount) displayPage(currentPage + 1);
            });
            controlsContainer.appendChild(nextButton);
        }

        function updatePaginationButtons() {
            // --- MODIFICADO: Usa la lista 'filteredGames' ---
            const pageCount = Math.ceil(filteredGames.length / itemsPerPage);
            const prevButton = document.querySelector('#pagination-controls button:first-child');
            const nextButton = document.querySelector('#pagination-controls button:last-child');
            
            if (prevButton) prevButton.disabled = currentPage === 1;
            if (nextButton) nextButton.disabled = currentPage === pageCount;

            document.querySelectorAll('.pagination-btn[data-page]').forEach(btn => {
                btn.classList.remove('active');
                if (parseInt(btn.dataset.page) === currentPage) {
                    btn.classList.add('active');
                }
            });
        }

        // --- FUNCIÓN DE FILTRADO REINTEGRADA ---
        function filterSource(source) {
            // Actualiza el estado visual de los botones de filtro
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            // Filtra la lista de juegos
            if (source === 'all') {
                filteredGames = [...allGames];
            } else {
                filteredGames = allGames.filter(game => game.source === source);
            }
            
            setupPagination();
            displayPage(1);
        }
        
        document.addEventListener('DOMContentLoaded', loadGames);
    </script>
</body></html>